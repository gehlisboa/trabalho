<<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Blog - Buscar Postagem</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body class="bg-light">

    <div class="container mt-5">
        <h3 class="mb-4">Buscar Postagem</h3>

        <div class="card p-4 shadow-sm mb-3">
            <div class="mb-3">
                <label class="form-label">ID da Postagem</label>
                <input type="number" id="codPostagem" class="form-control" placeholder="Digite o ID da postagem">
            </div>

            <button class="btn btn-primary w-100" onclick="getPostagens()">
                Buscar
            </button>
        </div>

        <div id="postagemContainer"></div>
    </div>

    <script>
        let isLoading = false;

        function getPostagens(){
            const cod = document.getElementById('codPostagem').value || '1';
            let postagem = { CodPostagem: cod };

            isLoading = true;
            const container = document.getElementById('postagemContainer');
            container.innerHTML = `<p class="text-primary">Carregando...</p>`;

            fetch('http://localhost/trabalho/Geovanna_Victoria/back_end/postagem/buscar_postagem_por_id.php',
                {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(postagem)
                }
            )
            .then(response => response.json())
            .then(response => {
                console.log(response);
                container.innerHTML = '';

                if(response.postagens && Array.isArray(response.postagens)){
                    response.postagens.forEach(p => {
                        const div = document.createElement('div');
                        div.classList.add('card', 'mb-3');
                        div.innerHTML = `
                            <div class="card-body">
                                <h5 class="card-title">${p.Titulo}</h5>
                                <p class="card-text">${p.Conteudo}</p>
                                <p class="card-text"><small class="text-muted">Autor: ${p.Autor} | Criado em: ${p.DataCriacao}</small></p>
                                ${p.Imagem ? `<img src="${p.Imagem}" class="img-fluid mt-2"/>` : ''}
                            </div>
                        `;
                        container.appendChild(div);
                    });
                } else {
                    container.innerHTML = '<p class="text-danger">Nenhuma postagem encontrada!</p>';
                }
            })
            .catch(erro => {
                console.log(erro);
                container.innerHTML = '<p class="text-danger">Erro na requisição.</p>';
            })
            .finally(()=>{
                isLoading = false;
            });
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>    
  </body>
</html>
